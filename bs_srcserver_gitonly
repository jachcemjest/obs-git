#!/usr/bin/perl -w

package bs_srcserver_gitonly;

use strict;

sub putinsrcrep {
  my ($projid, $packid, $tmpfile, $filename) = @_;

  open(F, '<', $tmpfile) || die("$tmpfile: $!\n");

  $git_hash = `GIT_DIR=$srcgitrep/$projid/$packid git hash-object -w $tmpfile`;
  # TODO: pridat ($git_hash, $filename) do $filelist-u XML co pride do funkcie nizsie
  unlink($tmpfile);

  return $git_hash;
}


sub urobcommit {
  my ($cgi, $projid, $packid) = @_; # zoznam suborov (subor,hash) je v $filelist (z PUTu)
  foreach ($file in $filelist) {
    # prida subor do commitu
    `GIT_DIR=srcgitrep/$projid/$packid git update-index --cacheinfo 0644 " + $file.git_hash + " " + $file.name`;
  }
  `GIT_DIR=srcgitrep/$projid/$packid git commit`;
  $hash = `GIT_DIR=srcgitrep/$projid/$packid git log | head -n 1 | cut -f 2 -d ' '`
  return $hash;
}
